


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Hands-on Go workshop">
      
      
        <link rel="canonical" href="https://MonsantoCo.github.io/go-workshop/14async/">
      
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-5.1.1">
    
    
      
        <title>14 - Getting out of sync - MonsantoCo Go Workshop</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.a676eddb.min.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/palette.b302131d.min.css">
      
      
        
        
        <meta name="theme-color" content="#00bcd4">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    <body dir="ltr" data-md-color-primary="cyan" data-md-color-accent="amber">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#buffered-channels" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://MonsantoCo.github.io/go-workshop/" title="MonsantoCo Go Workshop" class="md-header-nav__button md-logo" aria-label="MonsantoCo Go Workshop">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10,20V14H14V20H19V12H22L12,3L2,12H5V20H10Z" /></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z" /></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            MonsantoCo Go Workshop
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              14 - Getting out of sync
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" /></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://MonsantoCo.github.io/go-workshop/" title="MonsantoCo Go Workshop" class="md-nav__button md-logo" aria-label="MonsantoCo Go Workshop">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10,20V14H14V20H19V12H22L12,3L2,12H5V20H10Z" /></svg>

    </a>
    MonsantoCo Go Workshop
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../introduction/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Basics
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Basics" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Basics
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../01fmt/" title="01 - fmt-y Dumpty" class="md-nav__link">
      01 - fmt-y Dumpty
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../02conditionals/" title="02 - On one conditional" class="md-nav__link">
      02 - On one conditional
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../03slices/" title="03 - A healthy slice of arrays" class="md-nav__link">
      03 - A healthy slice of arrays
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../04loops/" title="04 - Stuck in the loop with you" class="md-nav__link">
      04 - Stuck in the loop with you
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../05functions/" title="05 - Becoming a functioning Gopher" class="md-nav__link">
      05 - Becoming a functioning Gopher
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../06errors/" title="06 - I am Error" class="md-nav__link">
      06 - I am Error
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Intermediate
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Intermediate" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Intermediate
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../07panics/" title="07 - Don't panic" class="md-nav__link">
      07 - Don't panic
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../08pointers/" title="08 - Get to the point" class="md-nav__link">
      08 - Get to the point
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../09structs/" title="09 - Hardwired to self de-struct" class="md-nav__link">
      09 - Hardwired to self de-struct
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../10interfaces/" title="10 - Unlike a user interface, these take a bit of explanation" class="md-nav__link">
      10 - Unlike a user interface, these take a bit of explanation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../11goroutines/" title="11 - Getting into the routine" class="md-nav__link">
      11 - Getting into the routine
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../12channels/" title="12 - Now you're thinking with channels" class="md-nav__link">
      12 - Now you're thinking with channels
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      Advanced
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Advanced" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Advanced
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../13currying/" title="13 - Staying anonymous" class="md-nav__link">
      13 - Staying anonymous
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        14 - Getting out of sync
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3,9H17V7H3V9M3,13H17V11H3V13M3,17H17V15H3V17M19,17H21V15H19V17M19,7V9H21V7H19M19,13H21V11H19V13Z" /></svg>
        </span>
      </label>
    
    <a href="./" title="14 - Getting out of sync" class="md-nav__link md-nav__link--active">
      14 - Getting out of sync
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#buffered-channels" class="md-nav__link">
    buffered channels
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#select" class="md-nav__link">
    select
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#non-blocking-channels" class="md-nav__link">
    non-blocking channels
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#close" class="md-nav__link">
    close
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hands-on" class="md-nav__link">
    Hands on!
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../15packages/" title="15 - Here's your package" class="md-nav__link">
      15 - Here's your package
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../16context/" title="16 - Taken out of context" class="md-nav__link">
      16 - Taken out of context
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#buffered-channels" class="md-nav__link">
    buffered channels
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#select" class="md-nav__link">
    select
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#non-blocking-channels" class="md-nav__link">
    non-blocking channels
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#close" class="md-nav__link">
    close
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hands-on" class="md-nav__link">
    Hands on!
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  
                
                
                  <h1>14 - Getting out of sync</h1>
                
                <p>Covered in this module:</p>
<ul>
<li>buffered channels</li>
<li>select</li>
<li>non-blocking channels</li>
<li>close</li>
</ul>
<h2 id="buffered-channels">buffered channels</h2>
<p>As discussed in <a href="../12channels/">Part 12</a>, channels by default are synchronous in that they require that both sender and receiver are ready before the value is sent across the channel. Channels can be buffered to enable values to be sent into the channel without a ready receiver.
<div class="highlight"><pre><span></span><code><span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">buffered</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">string</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

    <span class="nx">buffered</span> <span class="o">&lt;-</span> <span class="s">&quot;first&quot;</span>
    <span class="nx">buffered</span> <span class="o">&lt;-</span> <span class="s">&quot;second&quot;</span>
    <span class="nx">buffered</span> <span class="o">&lt;-</span> <span class="s">&quot;third&quot;</span>

    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="o">&lt;-</span><span class="nx">buffered</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="o">&lt;-</span><span class="nx">buffered</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="o">&lt;-</span><span class="nx">buffered</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></p>
<details class="example"><summary>prints</summary><div class="highlight"><pre><span></span><code>first
second
third
</code></pre></div>

</details>
<p>However, once the buffered channel is full, any new send will block until the channel has space.
<div class="highlight"><pre><span></span><code><span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">buffered</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">string</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="c1">// decrease buffer to 2</span>

    <span class="nx">buffered</span> <span class="o">&lt;-</span> <span class="s">&quot;first&quot;</span>
    <span class="nx">buffered</span> <span class="o">&lt;-</span> <span class="s">&quot;second&quot;</span>
    <span class="nx">buffered</span> <span class="o">&lt;-</span> <span class="s">&quot;third&quot;</span> <span class="c1">// this is now blocking</span>

    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="o">&lt;-</span><span class="nx">buffered</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="o">&lt;-</span><span class="nx">buffered</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="o">&lt;-</span><span class="nx">buffered</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></p>
<h2 id="select">select</h2>
<p>Select allows your routine to listen to several channels simultaneously and shares syntax with <code>switch</code> except that each case monitors a channel:
<div class="highlight"><pre><span></span><code><span class="kd">func</span> <span class="nx">waitToRespond</span><span class="p">(</span><span class="nx">waitTimeMs</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span><span class="p">,</span> <span class="nx">response</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">respond</span> <span class="kd">chan</span><span class="o">&lt;-</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Millisecond</span> <span class="o">*</span> <span class="nx">waitTimeMs</span><span class="p">)</span>
    <span class="nx">respond</span> <span class="o">&lt;-</span> <span class="nx">response</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">chan1</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">string</span><span class="p">)</span>
    <span class="nx">chan2</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">string</span><span class="p">)</span>

    <span class="k">go</span> <span class="nx">waitToRespond</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="s">&quot;first&quot;</span><span class="p">,</span> <span class="nx">chan1</span><span class="p">)</span>

    <span class="k">go</span> <span class="nx">waitToRespond</span><span class="p">(</span><span class="mi">250</span><span class="p">,</span> <span class="s">&quot;second&quot;</span><span class="p">,</span> <span class="nx">chan2</span><span class="p">)</span>

    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="mi">2</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="k">select</span> <span class="p">{</span>
        <span class="k">case</span> <span class="nx">res</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="nx">chan1</span><span class="p">:</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span>
        <span class="k">case</span> <span class="nx">res</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="nx">chan2</span><span class="p">:</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<details class="example"><summary>prints</summary><div class="highlight"><pre><span></span><code>second
first
</code></pre></div>

</details>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If two or more channels have messages ready to be received by a single <code>select</code>, one case is chosen at random.</p>
</div>
<h2 id="non-blocking-channels">non-blocking channels</h2>
<p>The <code>select</code> example above behaves in a synchronous manner as it will block until one of its cases is resolved. Adding a <code>default</code> case to the <code>select</code> will make it non-blocking:
<div class="highlight"><pre><span></span><code><span class="kd">func</span> <span class="nx">waitToRespond</span><span class="p">(</span><span class="nx">waitTimeMs</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span><span class="p">,</span> <span class="nx">response</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">respond</span> <span class="kd">chan</span><span class="o">&lt;-</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Millisecond</span> <span class="o">*</span> <span class="nx">waitTimeMs</span><span class="p">)</span>
    <span class="nx">respond</span> <span class="o">&lt;-</span> <span class="nx">response</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">chan1</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">string</span><span class="p">)</span>
    <span class="nx">chan2</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">string</span><span class="p">)</span>

    <span class="k">go</span> <span class="nx">waitToRespond</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="s">&quot;first&quot;</span><span class="p">,</span> <span class="nx">chan1</span><span class="p">)</span>

    <span class="k">go</span> <span class="nx">waitToRespond</span><span class="p">(</span><span class="mi">250</span><span class="p">,</span> <span class="s">&quot;second&quot;</span><span class="p">,</span> <span class="nx">chan2</span><span class="p">)</span>

    <span class="kd">var</span> <span class="nx">i</span> <span class="kt">int</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="mi">2</span> <span class="p">{</span>
        <span class="k">select</span> <span class="p">{</span>
        <span class="k">case</span> <span class="nx">res</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="nx">chan1</span><span class="p">:</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span>
            <span class="nx">i</span><span class="o">++</span>
        <span class="k">case</span> <span class="nx">res</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="nx">chan2</span><span class="p">:</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span>
            <span class="nx">i</span><span class="o">++</span>
        <span class="k">default</span><span class="p">:</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;nothing. waiting 50ms&quot;</span><span class="p">)</span>
            <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Millisecond</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<details class="example"><summary>prints</summary><div class="highlight"><pre><span></span><code>nothing. waiting 50ms
nothing. waiting 50ms
nothing. waiting 50ms
nothing. waiting 50ms
nothing. waiting 50ms
second
nothing. waiting 50ms
nothing. waiting 50ms
nothing. waiting 50ms
nothing. waiting 50ms
nothing. waiting 50ms
first
</code></pre></div>

</details>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For cases where you need a looping <code>select</code>, it is recommended to omit a default case unless your default is putting the loop to sleep for a period of time. <code>select</code> does a lazy block whereas <code>for</code> will continue to hog CPU.  </p>
</div>
<h2 id="close">close</h2>
<p>After your routine is done writing to a channel, it can <code>close</code> the channel to indicate to the receiver that no more items will be sent. The convention is that only the writer/sender should close a channel; this is enforced by there being no way to tell whether a channel is closed on the send end.
<div class="highlight"><pre><span></span><code><span class="kd">func</span> <span class="nx">ping</span><span class="p">(</span><span class="nx">tick</span> <span class="kd">chan</span><span class="o">&lt;-</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Time</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">ticker</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nx">NewTicker</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Millisecond</span> <span class="o">*</span> <span class="mi">250</span><span class="p">)</span>
    <span class="k">defer</span> <span class="nx">ticker</span><span class="p">.</span><span class="nx">Stop</span><span class="p">()</span>

    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">{</span>
        <span class="nx">tick</span> <span class="o">&lt;-</span> <span class="o">&lt;-</span><span class="nx">ticker</span><span class="p">.</span><span class="nx">C</span>
    <span class="p">}</span>
    <span class="nb">close</span><span class="p">(</span><span class="nx">tick</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">tick</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Time</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

    <span class="k">go</span> <span class="nx">ping</span><span class="p">(</span><span class="nx">tick</span><span class="p">)</span>

    <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Millisecond</span> <span class="o">*</span> <span class="mi">1050</span><span class="p">)</span>

    <span class="k">for</span> <span class="nx">t</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">tick</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;tick&quot;</span><span class="p">,</span> <span class="nx">t</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<details class="example"><summary>prints</summary><div class="highlight"><pre><span></span><code>tick 2019-02-22 14:48:28.680445 -0500 EST m=+0.255451520
tick 2019-02-22 14:48:28.929341 -0500 EST m=+0.504354086
tick 2019-02-22 14:48:29.180488 -0500 EST m=+0.755507241
tick 2019-02-22 14:48:29.425965 -0500 EST m=+1.000990704
</code></pre></div>

</details>
<p>You can check if a channel is open on the receiver end by capturing two values on the receive. The first value will be the received item and the second is a boolean which is true if the channel is open.
<div class="highlight"><pre><span></span><code><span class="kd">func</span> <span class="nx">ping</span><span class="p">(</span><span class="nx">tick</span> <span class="kd">chan</span><span class="o">&lt;-</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Time</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">ticker</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nx">NewTicker</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Millisecond</span> <span class="o">*</span> <span class="mi">250</span><span class="p">)</span>
    <span class="k">defer</span> <span class="nx">ticker</span><span class="p">.</span><span class="nx">Stop</span><span class="p">()</span>

    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">{</span>
        <span class="nx">tick</span> <span class="o">&lt;-</span> <span class="o">&lt;-</span><span class="nx">ticker</span><span class="p">.</span><span class="nx">C</span>
    <span class="p">}</span>
    <span class="nb">close</span><span class="p">(</span><span class="nx">tick</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">tick</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Time</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

    <span class="k">go</span> <span class="nx">ping</span><span class="p">(</span><span class="nx">tick</span><span class="p">)</span>

    <span class="k">for</span> <span class="p">{</span>
        <span class="nx">t</span><span class="p">,</span> <span class="nx">open</span> <span class="o">:=</span> <span class="o">&lt;-</span> <span class="nx">tick</span>
        <span class="k">if</span> <span class="nx">open</span> <span class="p">{</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;tick&quot;</span><span class="p">,</span><span class="nx">t</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">break</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<details class="example"><summary>prints</summary><div class="highlight"><pre><span></span><code>tick 2019-02-22 14:49:24.685916 -0500 EST m=+0.251246062
tick 2019-02-22 14:49:24.936428 -0500 EST m=+0.501765172
tick 2019-02-22 14:49:25.188174 -0500 EST m=+0.753517292
tick 2019-02-22 14:49:25.43667 -0500 EST m=+1.002020070
</code></pre></div>

</details>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The close signal takes up a spot in a buffered channel, so the <code>close</code> will block if there is no room in the channel.</p>
</div>
<p><code>close</code> works for both buffered and unbuffered channels and is a permanent state. Reading from a closed channel will continue to return false for its second value in perpetuity. You can not 'unclose' a channel. Also, attempting to send a value to a closed channel causes a panic. If you have multiple senders for a single channel, take care to make sure all senders are done before closing the channel. If you close the channel too early, an active sender routine will trigger a panic.</p>
<p>For buffered channels, any values put in the channel prior to the close will still be delivered in the order they were sent before the <code>close</code> signal will be received.</p>
<p>It is not required to <code>close</code> a channel. Channels can be used indefinitely or reinitialized as needed. <code>close</code> is just another way to signal between goroutines. </p>
<h2 id="hands-on">Hands on!</h2>
<ol>
<li>In the repo, open the file <code>./advanced/14async.go</code></li>
<li>Complete the TODOs</li>
<li>Run <code>make 14</code> from project root (alternatively, type <code>go run ./14async.go</code>)</li>
<li>Example implementation available on <code>solutions</code> branch</li>
</ol>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../13currying/" title="13 - Staying anonymous" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                13 - Staying anonymous
              </div>
            </div>
          </a>
        
        
          <a href="../15packages/" title="15 - Here's your package" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                15 - Here's your package
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4,11V13H16L10.5,18.5L11.92,19.92L19.84,12L11.92,4.08L10.5,5.5L16,11H4Z" /></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.c51dfa35.min.js"></script>
      <script src="../assets/javascripts/bundle.eaaa3931.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.58d22e8e.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>